%% Include File für alle Etüden
%% um gleiches Layout sicherzustellen

FootLeft = #(string-append "" )
FootCenter = #(string-append "")
FootRight = #(string-append "gesetzt mit LILYPOND " (lilypond-version) " am " (strftime "%d.%m.%Y %H:%M:%S" (localtime (current-time))))

\paper {
  #(set-paper-size "a4")
  oddFooterMarkup = \markup \fill-line {
    \abs-fontsize #9 { \FootLeft }
    % \abs-fontsize #7.0 { \italic { \FootCenter } }
    \abs-fontsize #9 { \FootRight }
  }

  fonts = #(make-pango-font-tree
            "Palatino Linotype" ;Serifenschrift
            "Ebrima"   ;serifenlose Schrift, z.B. für Akkordbezeichnungen
            "Consolas" ;dicktengleiche Schrift
            (/ (* staff-height pt) 2.5))
  annotate-spacing = ##f
  %top-system-spacing.basic-distance = #40
  %score-system-spacing.basic-distance = #20
  system-system-spacing.extra-distance = #0
  %last-bottom-spacing.basic-distance = #20
  left-margin = #10
  %top-margin = #25
  %markup-system-spacing #'padding = #5
  system-system-spacing.basic-distance = #0
  score-system-spacing =
  #'((basic-distance . 5)
     (minimum-distance . 5)
     (padding . 1)
     (stretchability . 5))
}

\layout {
  indent = #15
  ragged-last-bottom = ##f
  ragged-last = ##t
  ragged-bottom = ##t
  %line-width = #190

  \context {
    \Staff
    \omit ClefModifier
    %\override explicitKeySignatureVisibility = #all-invisible
    \override KeySignature.break-visibility = #all-invisible
    %\override KeySignatureVisibility = #end-of-line-invisible
    %\override explicitKeySignatureVisibility = #begin-of-line-visible
  }

  \context {
    \Score
    \remove "Bar_number_engraver" % Taktnummerierung
    \override BarNumber.break-visibility = #'#(#f #f #f)
    \override NonMusicalPaperColumn.line-break-permission = ##f
    \override NonMusicalPaperColumn.page-break-permission = ##f
  }
}
#(define-markup-command (center-dyn layout props atr-text dyn)(markup? string?)
   "x-align on center of dynamic"
   (let* (
           (text (string-append atr-text " "))
           (atr-stencil (interpret-markup layout props (markup #:normal-text #:italic text)))
           (dyn-stencil (interpret-markup layout props (markup #:dynamic dyn)))
           (atr-x-ext (ly:stencil-extent atr-stencil X))
           (dyn-x-ext (ly:stencil-extent dyn-stencil X))
           (atr-x (- (cdr atr-x-ext)(car atr-x-ext)))
           (dyn-x (- (cdr dyn-x-ext)(car dyn-x-ext)))
           (x-align
            (* (-
                (/ (+ atr-x (/ dyn-x 2)) (+ atr-x dyn-x) )
                0.5) 2)
            )
           )
     (interpret-markup layout props (markup #:halign x-align #:concat (#:normal-text #:italic text #:dynamic dyn)))
     ))
% define a 'new' attributed dynamic script
#(define (make-atr-dynamic-script atr dyn)
   (let ((dynamic (make-dynamic-script (markup #:center-dyn atr dyn))))
     (ly:music-set-property! dynamic 'tweaks (acons 'X-offset 0 (ly:music-property dynamic 'tweaks)))
     dynamic))

% define some attributed dynamics
pocof = #(make-atr-dynamic-script "poco" "f")
menof = #(make-atr-dynamic-script "meno" "f")
subp = #(make-atr-dynamic-script "subito" "p")
subf = #(make-atr-dynamic-script "subito" "f")
dolp = #(make-atr-dynamic-script "dolce" "p")
